# Conditionally set array of packages to install
# vim: filetype=bash

packages=()
removepkg=()
eval "$(. /etc/os-release && typeset -p ID)"

# Always install
packages+=(
  curl
  expect
  extundelete
  gawk
  git
  htop
  jq
  ranger
  shellcheck
  stow
  tree
  w3m
  zsh
)

# Debian-based only (apt)
[[ $ID =~ ^(debian|ubuntu|pop|raspbian)$ ]] && packages+=(
  wbritish
  wget2
  xz-utils
)

# RHEL-related only (rpm)
[[ $ID =~ ^(rhel|fedora|amzn|ol|rocky)$ ]] && packages+=(
  words
  xz
)

# Guardian-agent dependencies
# - bastion hosts and laptop/desktop clients (name starts with h)
if [[ $(hostname -s) =~ ^(bastet|h.+)$ ]]; then
  # Debian-based
  [[ $ID =~ ^(debian|ubuntu|pop|raspbian)$ ]] && packages+=(
    autossh
    openssh-client
    ssh-askpass
  )
  # RHEL-related
  [[ $ID =~ ^(rhel|fedora|amzn|ol|rocky)$ ]] && packages+=(
    autossh
    openssh-askpass
    openssh-clients
  )
fi

# Linux desktop/laptop clients (not WSL)
if [[ -n $DISPLAY ]] && grep -vqi microsoft /proc/version; then
  packages+=(
    alacritty
    copyq
    feh
    nsxiv
    qutebrowser
  )
fi

# WSL clients
if grep -qi microsoft /proc/version; then
  packages+=(
    alacritty
    nsxiv
    qutebrowser
  )
fi

# Always remove
removepkg+=(
  xterm
)
